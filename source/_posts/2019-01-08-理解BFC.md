---
title: 理解BFC
description: <!-- more -->
translate_title: understanding-bfc
date: 2019-01-08 18:07:29
updated: 2019-01-08 18:07:29
tags:
  - BFC
  - Block Formatting Context
categories:
  - CSS
---

## 定义
** 块格式化上下文（Block Formatting Context，BFC） **是Web页面的可视化CSS渲染的一部分，是布局过程中生成块级盒子的区域，也是浮动元素与其他元素的交互限定区域。

A ** block formatting context ** is a part of a visual CSS rendering of a Web page. It is the region in which the layout of block boxes occurs and in which floats interact with other elements.

## 创建块格式化上下文方式

- 根元素或包含根元素的元素
- 浮动元素（元素的 `float` 不是 `none）
- 绝对定位元素（元素的 `position` 为 `absolute` 或 `fixed`）
- 行内块元素（元素的 `display` 为 `inline-block`）
- 表格单元格（元素的 `display`为 `table-cell`，HTML表格单元格默认为该值）
- 表格标题（元素的 `display` 为 `table-caption`，HTML表格标题默认为该值）
- 匿名表格单元格元素（元素的 `display`为 `table`、`table-row`、 `table-row-group`、`table-header-group`、`table-footer-group`（分别是HTML `table`、`row`、`tbody`、`thead`、`tfoot`的默认属性）或 `inline-table`）
- `overflow` 值不为 `visible` 的块元素
- `display` 值为 `flow-root` 的元素
- `contain` 值为 `layout`、`content`或 `strict` 的元素
- 弹性元素（`display`为 `flex` 或 `inline-flex`元素的直接子元素）
- 网格元素（`display`为 `grid` 或 `inline-grid` 元素的直接子元素）
- 多列容器（元素的 `column-count` 或 `column-width` 不为 `auto`，包括 `column-count` 为 `1`）
- `column-span` 为 `all` 的元素始终会创建一个新的BFC，即使该元素没有包裹在一个多列容器中（标准变更，Chrome bug）

## 实现

### html（根元素或包含根元素的元素）
``` html
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>
  *{margin:0; padding:0;}
  html{background: #f9fae2;}
  body{background: #cad9f2;}
  .root-bfc{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
  }
</style></head><body>
  <div class="root-bfc"></div>
</body></html> 
```

![019](/images/css/019.png)

`html`根元素不因为内部元素的`margin`外溢，而`body`元素会外溢

### float!=none（浮动元素）
``` html
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>
  *{margin:0; padding:0;}
  html{background: #f9fae2;}
  body{background: #cad9f2;}
  .float-wrap{
    overflow: hidden;
  }
  .float-left{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
    float: left;
  }
  .float-right{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
    float: right;
  }
</style></head><body>
  <div class="float-wrap">
    <div class="float-left"></div>
    <div class="float-right"></div>
  </div>
</body></html> 
```
![020](/images/css/020.png)

添加float之后会产生浮动脱离文档流，这时根据需要在外层清除浮动；如果在body元素清除浮动，`overflow`以外的方法都可以使用

### position=absolute、fixed（绝对定位元素）
``` html
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>
  *{margin:0; padding:0;}
  html{background: #f9fae2;}
  body{background: #cad9f2;}
  .position-wrap{
  }
  .position-absolute{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
    position: absolute;
    top: 10px;
    left: 10px;
  }
  .position-fixed{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
    position: fixed;
    right: 10px;
    top: 10px;
  }
</style></head><body>
  <div class="position-wrap">
    <div class="position-absolute"></div>
    <div class="position-fixed"></div>
  </div>
</body></html> 
```
![021](/images/css/021.png)

定位之后margin不会消失，但是会脱离文档流

如果不加位置数据，同样可以实现bfc，后续内容要使用`margin-top`撑开，等其他方法

### display=inline-block（行内快元素）
``` html
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>
  *{margin:0; padding:0;}
  html{background: #f9fae2;}
  body{background: #cad9f2;}
  
  .inline-block-el{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
    display: inline-block;
  }
</style></head><body>
  <div class="inline-block-wrap">
    <div class="inline-block-el"></div>
    <div class="inline-block-el"></div>
  </div>
</body></html> 
```

`display: inline-block`使用后`margin`不会穿透父元素，同时还需要解决如果两个inline-block在同一行，会有元素之间有空隙、元素上浮无法对齐的问题；
也可以作用在父元素上面，子元素`margin`属性不会穿透父元素，也可能遇到上面两个问题；


### display=table-cell（表格单元格）
``` html
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>
  *{margin:0; padding:0;}
  html{background: #f9fae2;}
  body{background: #cad9f2;}
  
  .table-cell-wrap{
    display: table-cell;
  }
  .table-cell-el{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
  }
</style></head><body>
  <div class="table-cell-wrap">
    <div class="table-cell-el"></div>
    <div class="table-cell-el"></div>
  </div>
</body></html> 
```

在父元素使用作为一个表格单元格，子元素`margin`属性不会穿透父元素；

### display=table-caption（表格标题）
``` html
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>
  *{margin:0; padding:0;}
  html{background: #f9fae2;}
  body{background: #cad9f2;}
  
  .table-caption-wrap{
    display: table-caption;
  }
  .table-caption-el{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
  }
</style></head><body>
  <div class="table-caption-wrap">
    <div class="table-caption-el"></div>
    <div class="table-caption-el"></div>
  </div>
</body></html> 
```

在父元素使用作为一个表格标题显示，子元素`margin`属性不会穿透父元素；

### display=some value（匿名表格单元格元素）

> 元素的 `display`为 `table`、`table-row`、 `table-row-group`、`table-header-group`、`table-footer-group`（分别是HTML table、row、tbody、thead、tfoot的默认属性）或 `inline-table`

- `table`、`table-row`、 `table-row-group`、`table-header-group`、`table-footer-group` 的用法同`table-caption`，需要使用在父元素子元素才不会穿透父元素
- `inline-table` 的用法同 `inline-block`

### overflow!=visible
``` html
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>
  *{margin:0; padding:0;}
  html{background: #f9fae2;}
  body{background: #cad9f2;}
  
  .overflow-wrap--auto{
    overflow: auto;
  }
  .overflow-wrap--hidden{
    overflow: hidden;
  }
  .overflow-wrap--overlay{
    overflow: overlay;
  }
  .overflow-wrap--scroll{
    overflow: scroll;
  }
  .overflow-el{
    width: 100px;
    height: 100px;
    margin: 50px;
    background: #ff8d8d;
  }
</style></head><body>
  <div class="overflow-wrap overflow-wrap--auto">
    <div class="overflow-el"></div>
    <div class="overflow-el"></div>
  </div>
</body></html>
```

- `overflow`属性为`auto` `hidden` `overlay` `scroll` 时触发bfc，其子元素`margin`不会穿透
- 如果父元素为四个值时，当前元素可使用`inherit`

### display=flow-root
``` html
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>
  *{margin:0; padding:0;}
  html{background: #f9fae2;}
  body{background: #cad9f2;}
  
  .flow-root-inner{float:left; width: 100px; height: 100px; background: #e2e2e2;}
  .clearfix{
    display: flow-root;
  }
  @supports not (display:flow-root) { 
    .clearfix::after{content:" "; display:block; clear:both; visibility:hidden; height:0} 
    .clearfix{zoom:1} 
  }
</style></head><body>
  <div class="flow-root-wraper clearfix">
    <div class="flow-root-inner"></div>
  </div>
</body></html>
```

`display: flow-root`只支持Firefox 53+、Chrome 58+、Opera 45+，通过`@supports`能支持Edge

### contain=layout、content、strict
``` html

```

### display=flex、inline-flex（弹性元素）
``` html

```

### display=grid、inline-grid（网格元素）
``` html

```

### column-count、column-width!=auto（多列容器）
``` html

```

### column-span=all
``` html

```

## 总结

# 参考

https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Block_formatting_context
https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context

https://www.w3.org/TR/CSS21/visuren.html#block-formatting

https://drafts.csswg.org/css-display/#block-formatting-context

https://developer.mozilla.org/en-US/docs/Web/CSS/display
https://www.w3cplus.com/css3/display-flow-root.html